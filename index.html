<!DOCTYPE html>
<html>
    <head>
        <title>Simple Map</title>
        <meta name="viewport" content="initial-scale=1.0">
        <meta charset="utf-8">
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js" type="text/javascript"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js" type="text/javascript"></script>
        <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/smoothness/jquery-ui.css">
        <style>
            html, body {
                height: 100%;
                margin: 0;
                padding: 0;
            }
            #map {
                height: 100%;
            }
            .autostart {
              position: fixed;
              right: 30px;
              top: 40px;
              width: 40%;
            }
            .autoend {
              position: fixed;
              right: 30px;
              top: 80px;
              width: 40%;
            }
        </style>
    </head>
    <body>
      <div id="map">
      </div>
      <form class="autostart">
        <h3>Start: <input id="autocomplete" class="autocomplete" type="search" name="keyword" placeholder="City name or airport code" /></h3>
      </form>
      <form class="autoend">
        <h3>End: <input id="autocomplete" class="autocomplete" type="search" name="keyword" placeholder="City name or airport code" /></h3>
      </form>
      <script>
      //document.write('\//<SCR'+'IPT src=https://maps.googleapis.com/maps/api/js?key=AIzaSyA_5h7UwDWuzihCPUwd8FA_NKgEJM30URk&callback=initMap><\/SCR'+'IPT>');
          var map;
          function initMap() {
          map = new google.maps.Map(document.getElementById('map'), {
              center: {lat: 37.0902, lng: -95.7129},
              zoom: 4
            });
          };
        </script>
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA_5h7UwDWuzihCPUwd8FA_NKgEJM30URk&callback=initMap"></script>

        <script>
          document.addEventListener("DOMContentLoaded", function(event){
            var flightPoints = [];
            $('.autocomplete').autocomplete({
                source: function( request, response ) {
                    $.ajax({
                        url: "//www.air-port-codes.com/search/",
                        jsonp: "callback",
                        dataType: "jsonp",
                        data: {
                            term: request.term, // input field value
                            limit: 100, // default is 30
                            size: 0, // default is 0
                            key: "b34e0b6ea2", // dont forget to add your API Key from your air-port-codes account
                            secret: "ce36bb996d28c2c"
                        },
                        success: function( data ) {
                          //debugger;
                            if (data.status) { // success
                              //data.airports.filter(function (e) {
                                //return e.country.iso === "US";
                                //debugger;
                              //}//);
                                //debugger;
                                  //$.each(data.airports, function(index, value){
                                  //  if (value.country.iso !== "US"){
                                  //    data.airports[index].splice(--index, 1)
                                  //  }
                                  //})
                                response( $.map( data.airports.filter(function (e) {
                                  return e.country.iso === "US";
                                }), function( item ) {
                                  //debugger;
                                    return {
                                        label: item.name +'(' + item.iata + ')',
                                        state: item.state.abbr,
                                        LatLng: {
                                          lat: parseFloat(item.latitude),
                                          lng: parseFloat(item.longitude)
                                        }
                                    }
                                }));
                            } else { // no results
                                response();
                            }
                        }
                    });
                },
                select: function( event, ui ) {
                    // do something for click event
                    //$('.autocomplete').input('');
                    console.log(ui);
                    console.log(ui.item);
                    console.log(ui.item.location);
                    var marker = new google.maps.Marker({
                      map: map,
                      animation: google.maps.Animation.DROP,
                      position: ui.item.LatLng,
                      coor: {
                        lat: ui.item.LatLng.lat,
                        lng: ui.item.LatLng.lng
                      },
                      label: ui.item.label,
                      title: "wooot"//ui.item.label
                    });
                    flightPoints.push(marker.coor);
                    console.log(flightPoints.length);
                    if(flightPoints.length == 2){
                      //var flightPlanCoordinates = [
                        //flightPoints,
                        //{flightPoints[1].lat, flightPoints[1].lng}
                      //];

                      var flightPath = new google.maps.Polyline({
                        map: map,
                        path: flightPoints,//flightPlanCoordinates,
                        geodesic: true,
                        strokeColor: '#FF0000',
                        strokeOpacity: 1.0,
                        strokeWeight: 2
                      });
                      debugger;
                    };
                }

            });
        });
        </script>

    </body>
</html>
